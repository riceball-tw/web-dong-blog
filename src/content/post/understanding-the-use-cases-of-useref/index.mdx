---
isDraft: false
icon: { name: 'material-symbols:line-end-arrow-outline-rounded', title: 'ç®­é ­ç¬¦è™Ÿ' }
title: 'Understanding the use cases of useRef'
titleTC: 'å¾å¯¦ä¾‹äº†è§£ useRef çš„ä½¿ç”¨æƒ…å¢ƒ'
excerpt: 'React useRef èˆ‡ä¸€èˆ¬å®šç¾©è®Šæ•¸å·®åœ¨å“ªï¼Ÿæˆ‘æ±ºå®šæŠŠä»–å€‘è©³ç´°çš„æ¯”è¼ƒå¯«åœ¨é€™ç¯‡æ–‡ç« ä¸­ã€‚ç°¡å–®ä¾†èªª useRef æ˜¯ä¸€å€‹ React Hook å¯ä»¥è®“ä½ åƒè€ƒä¸€å€‹å€¼ä¸¦ä¸æœƒå—åˆ° React çš„é‡æ–°æ¸²æŸ“å½±éŸ¿ï¼Œé€éå¯¦éš›ä»£ç¢¼æ“ä½œç¯„ä¾‹ä¾†ç†è§£å®ƒèˆ‡é¡ä¼¼çš„ useState é‚„æœ‰ä¸€èˆ¬è®Šæ•¸çš„å·®ç•°ã€‚'
category: 'React'
tags: ['Hook']
publishDate: 2023-02-21
---

import UseStateInput from '@/components/post/understanding-the-use-cases-of-useref/UseStateInput.jsx';

## useRef èªªæ˜

> `useRef` æ˜¯ä¸€å€‹ Hook å¯ä»¥è®“ä½ åƒè€ƒä¸€å€‹å€¼ä¸¦ä¸æœƒå—åˆ° React çš„é‡æ–°æ¸²æŸ“å½±éŸ¿

ä»¥ä¸Šæ˜¯æ ¹æ“š [React å®˜æ–¹æ–‡æª”](https://beta.reactjs.org/reference/react/useRef) å° `useRef` çš„èªªæ˜ï¼Œä½†é€™å¥è©±é€™ç©¶ç«Ÿä»£è¡¨ä»€éº¼æ„æ€ï¼Ÿç°¡å–®ä¾†èªªæˆ‘æœƒ**æŠŠ `useRef` ç•¶ä½œæ˜¯ `useState` ä½†ä¸æœƒè§¸ç™¼é‡æ–°æ¸²æŸ“** ï¼ŒReact æœƒå¹«ä½ è¨˜éŒ„é€™ç­†è³‡æ–™ï¼Œå°±ç®—å…ƒä»¶é‡æ–°æ¸²æŸ“äº†é‚„æ˜¯å­˜åœ¨ã€‚

## ç¯„ä¾‹ä¸€ï¼šè¨˜éŒ„å…ƒä»¶çš„è³‡æ–™ç‹€æ…‹ï¼Œä¸å—æ¸²æŸ“å½±éŸ¿

é€™éº¼èªªé‚„æ˜¯æœ‰äº›æŠ½è±¡ï¼Œè®“æˆ‘å€‘ä¾†æ¨¡æ“¬ä¸€å€‹ç°¡å–®çš„éœ€æ±‚ä¸¦å˜—è©¦å¯¦ç¾å®ƒï¼š**ã€Œè¨ˆç®—ä¸€å€‹å…ƒä»¶ç©¶ç«Ÿè¢«é‡æ–°æ¸²æŸ“äº†å¹¾æ¬¡ã€**ã€‚é¦–å…ˆåœ¨ç•«é¢ä¸Šå®šç¾©ä¸€å€‹è¼¸å…¥æ¡†ï¼Œç•¶ä½¿ç”¨è€…è¼¸å…¥åå­—æ™‚ï¼Œæœƒåœ¨ç•«é¢ä¸Šé¡¯ç¤ºã€Œæˆ‘çš„åå­—æ˜¯ x ã€ä»¥åŠã€Œæˆ‘é‡æ–°æ¸²æŸ“äº† x æ¬¡ã€ã€‚

```jsx
// å…ˆå®šç¾©æ¨¡æ¿çš„æ¨¡æ¨£
<div>
  <input value={name} onChange={(e) => setName(e.target.value)} />
  <div>æˆ‘çš„åå­—æ˜¯ {name}</div>
  <div>æˆ‘é‡æ–°æ¸²æŸ“äº† {renderCount} æ¬¡</div>
</div>
```

ä¸¦ä¸”å®šç¾©è³‡æ–™çš„éƒ¨åˆ†ï¼Œé€™è£¡ä½¿ç”¨ `useState` ä¾†å®šç¾© `name` å’Œ `renderCount` é€™å…©å€‹è®Šæ•¸ï¼Œä¸¦ä¸”åœ¨æ¯æ¬¡å…ƒä»¶åˆ·æ–°æ™‚å°±è®“ `renderCount` + 1ã€‚

```jsx
// è™•ç†è³‡æ–™çš„éƒ¨åˆ†
const [name, setName] = useState('');
const [renderCount, setRenderCount] = useState(0);

useEffect(() => {
  setRenderCount((prevCount) => prevCount + 1);
});
```

çœ‹èµ·ä¾†å¾ˆç°¡å–®ï¼Œæ‡‰è©²ä¸æœƒæœ‰ä»€éº¼å•é¡Œï¼Ÿä½†å¯¦éš›ä¸Šå‰é¢çš„ç¨‹å¼é‚è¼¯ä¸Šæœ‰éå¸¸å¤§çš„æ¼æ´ï¼Œå®ƒç„¡æ³•é‹ä½œä¸”æœƒç˜‹ç‹‚è·³å‡ºä»¥ä¸‹çš„éŒ¯èª¤ï¼

`Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render.`

é€™æ˜¯å› ç‚ºè¼¸å…¥å°è‡´è§¸ç™¼å…ƒä»¶é‡æ–°æ¸²æŸ“ï¼Œé€™æ™‚å€™è§¸ç™¼ `renderCount + 1` åˆæœƒå°è‡´å…ƒä»¶é‡æ–°æ¸²æŸ“ï¼Œé€²å…¥ç„¡é™çš„æ›´æ–° State > è§¸ç™¼æ¸²æŸ“ > æ›´æ–° State > è§¸ç™¼æ¸²æŸ“ â€¦â€¦ ğŸ˜­ï¼Œé€™æ™‚å€™å°±æ˜¯ä½¿ç”¨ `useRef` çš„å…¸å‹æ™‚æ©Ÿã€‚

åªéœ€è¦æŠŠ `renderCount` æ”¹æˆä½¿ç”¨ `useRef` ä¾†å®šç¾©ï¼Œç¨‹å¼å°±å¯ä»¥å¦‚æœŸé‹ä½œäº†ï¼Œé€™æ˜¯å› ç‚º `useRef` ä¸¦ä¸æœƒé€ æˆå…ƒä»¶é‡æ–°æ¸²æŸ“ï¼š

```jsx
const [name, setName] = useState('');
const renderCount = useRef(1);

useEffect(() => {
  renderCount.current += 1;
});
```

<UseStateInput client:idle />

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ç¤ºç¯„äº†å¦‚æœéœ€è¦åœ¨å…ƒä»¶é‡æ–°æ¸²æŸ“æ™‚ä¿ç•™æŸäº›ç‹€æ…‹ï¼Œå°±å¯ä»¥ä½¿ç”¨ `useRef` é€™å€‹ Hook ä¾†è¨˜éŒ„ã€‚

## ç¯„ä¾‹äºŒï¼šé¸å–å…ƒç´ 

ç”±æ–¼ React æ˜¯å»ºæ§‹è™›æ“¬ DOM ä¾†è™•ç†å…ƒä»¶çš„æ¸²æŸ“ï¼Œæ‰€ä»¥æˆ‘å€‘ç„¡æ³•ç›´æ¥ä½¿ç”¨ `querySelector`ï¼Œé€™å€‹æ–¹æ³•åªèƒ½å–å¾—çœŸå¯¦çš„ DOMï¼Œè€Œä¸æ˜¯ React çš„è™›æ“¬ DOMã€‚åœ¨ React ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ `ref` ä¾†é¸å–è™›æ“¬çš„ DOM å…ƒç´ ï¼Œä½¿ç”¨ `useRef` è¨˜éŒ„ä¸‹ä¾†ã€‚

```jsx
const [name, setName] = useState('');
const inputRef = useRef(null);

useEffect(() => {
  inputRef.current.focus();
}, []);
```

åœ¨é€™å€‹æ¡ˆä¾‹ä¸­ï¼Œä½ å¯ä»¥æƒ³åƒå°±åƒæ˜¯ Vitural DOM ç‰ˆçš„ `querySelector`ï¼Œåªæ˜¯é€™å€‹æ–¹æ³•å¯ä»¥åœ¨ React çš„å…ƒä»¶ä¸­ä½¿ç”¨ã€‚

## ç¸½çµ

æ—¢ç„¶èªªåˆ° `useRef` å°±ä¸èƒ½ä¸è«‡ `useState` èˆ‡å…¶ä»–å®šç¾©è®Šæ•¸çš„æ–¹å¼ï¼Œå®ƒå€‘æœ‰ä¸åŒçš„ç”¨é€”å’Œç‰¹é»ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹å®ƒå€‘çš„å·®ç•°ï¼š

### æ–¹æ³•ä¸€ï¼šå®šç¾©è®Šæ•¸åœ¨å…ƒä»¶å¤–

```jsx
let outside = 0;
const App = () => {
  return <div>{outside}</div>;
};
```

é€™éº¼åšå°±ç›¸ç•¶æ–¼å®šç¾©äº†ä¸€å€‹å…¨åŸŸè®Šæ•¸ï¼Œå®ƒæœƒ**åœ¨åŠ è¼‰æ•´å€‹æ‡‰ç”¨ç¨‹å¼çš„æ™‚å€™è¢«å»ºç«‹ï¼Œä¸¦ä¸”åœ¨æ•´å€‹æ‡‰ç”¨ç¨‹å¼ä¸­éƒ½å¯ä»¥ä½¿ç”¨**ï¼Œé€™ç¨®æ–¹å¼åœ¨æŸäº›æƒ…æ³ä¸‹æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæ¯”å¦‚ç•¶æˆ‘å€‘æœ‰å¤šå€‹å…ƒä»¶éœ€è¦å…±äº«åŒä¸€å€‹è®Šæ•¸æ™‚ï¼Œä½†ä¹Ÿæœƒæœ‰ä¸€äº›æ½›åœ¨çš„å•é¡Œåƒæ˜¯ï¼š

1. **å‘½åè¡çª**ï¼šå¦‚æœå¤šå€‹å…ƒä»¶éƒ½ä½¿ç”¨äº†åŒä¸€å€‹è®Šæ•¸åç¨±ï¼Œå°±æœƒé€ æˆå‘½åè¡çªã€‚
2. **é›£ä»¥è¿½è¹¤**ï¼šç•¶è®Šæ•¸è¢«å¤šå€‹å…ƒä»¶å…±äº«æ™‚ï¼Œå¾ˆé›£è¿½è¹¤è®Šæ•¸æ˜¯å¦‚ä½•è¢«ä¿®æ”¹çš„ã€‚é€™å¯èƒ½æœƒå°è‡´é›£ä»¥èª¿è©¦çš„å•é¡Œã€‚
3. **é›£ä»¥æ¸¬è©¦**ï¼šå°è‡´ç¨‹å¼çš„è¤‡é›œæ€§å’Œä¸ç©©å®šæ€§ä¸Šå‡ä¸”é›£ä»¥é ä¼°èˆ‡æ¸¬è©¦ã€‚

ç¶œåˆä¸‹ä¾†ä¸æœƒæ˜¯ä¸€å€‹å¾ˆå¥½çš„æ–¹æ³•ï¼Œå¦‚æœå¸Œæœ›ç‹€æ…‹èƒ½å¤ åœ¨å…ƒä»¶ä¹‹é–“å…±äº«ï¼Œå¯ä»¥å‚³é [Props](https://beta.reactjs.org/learn/passing-props-to-a-component) æˆ–ä½¿ç”¨ [useContext](https://beta.reactjs.org/reference/react/useContext) ä¾†é”æˆï¼Œè€Œéä½¿ç”¨å…¨åŸŸè®Šæ•¸ã€‚

### æ–¹æ³•äºŒï¼šå®šç¾©è®Šæ•¸åœ¨å…ƒä»¶å…§

```jsx
const App = () => {
  let inside = 0;
  return <div>{inside}</div>;
};
```

é€™éº¼åšèˆ‡æ–¹æ³•ä¸€é¡ä¼¼ï¼Œåªæ˜¯è®Šæ•¸è¢«å®šç¾©åœ¨å…ƒä»¶å…§éƒ¨ï¼Œé€™æ¨£å°±ä¸æœƒæœ‰å‘½åè¡çªçš„å•é¡Œï¼Œä½†ä¸€å€‹å¾ˆå¤§çš„å€åˆ¥æ˜¯ï¼Œ**é€™å€‹è®Šæ•¸æœƒåœ¨æ¯æ¬¡å…ƒä»¶åˆ·æ–°æ™‚é‡ç½®**ã€‚

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ useState

ç›¸ä¿¡å­¸ç¿’ React ç¬¬ä¸€å€‹ç¢°çš„ Hook å°±æ˜¯ `useState`ï¼Œå› æ­¤ä¹Ÿä¸è´…è¿°ï¼Œå°±æ˜¯**ç•¶ setState æ™‚ï¼Œå…ƒä»¶æœƒé‡æ–°æ¸²æŸ“**ã€‚

```jsx
const App = () => {
  const [state, setState] = useState(0);
  return <div>{state}</div>;
};
```

### æ–¹æ³•å››ï¼šä½¿ç”¨ useRef

èˆ‡ `useState` é¡ä¼¼ï¼Œä½†**ä¸æœƒè§¸ç™¼é‡æ–°æ¸²æŸ“**ã€‚

```jsx
const App = () => {
  const ref = useRef(0);
  return <div>{ref.current}</div>;
};
```

## è³‡æ–™ä¾†æº

- [Learn useRef in 11 Minutes - Web Dev Simplified](https://www.youtube.com/watch?v=t2ypzz6gJm0)
- [useRef - React Docs](https://beta.reactjs.org/reference/react/useRef)
- [Why need useRef and not mutable variable? - stack overflow](https://stackoverflow.com/questions/57444154/why-need-useref-and-not-mutable-variable)
