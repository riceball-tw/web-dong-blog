---
isDraft: false
icon: { name: 'material-symbols:developer-guide-outline-rounded', title: 'ç®±å­ç¬¦è™Ÿ' }
title: 'Future of the Web - Native Web Components'
titleTC: 'äº†è§£ç¶²é å…ƒä»¶åŒ–çš„æœªä¾†ï¼šWeb Components'
excerpt: 'å¾å¾ˆæ—©ä»¥å‰å°±å¤§è‡´çŸ¥é“ç€è¦½å™¨é–‹å§‹æ¨å‡º Web Components ç›¸é—œ API èˆ‡æ¨™æº–ï¼Œä½†ä¸€ç›´æ²’æœ‰æ©Ÿæœƒåœ¨å¯¦æˆ°ä¸­ä½¿ç”¨é€™é …æŠ€è¡“ã€‚æƒ³æ’°å¯«é€™ç¯‡æ–‡ç« è¨˜éŒ„æ˜¯å› ç‚ºéš¨è‘—æ™‚é–“æ¨ç§»ç™¼ç¾ Web Components çš„æ‡‰ç”¨ç¯„ç–‡è¶Šä¾†è¶Šå»£ï¼Œå› æ­¤è¶è‘—æœ‰ç©ºä¹Ÿä¾†äº†è§£ä¸€ä¸‹ç›¸é—œçŸ¥è­˜ï¼Œä¸¦ä¸”åˆ†æå®ƒèˆ‡ç¾æœ‰çš„è§£æ±ºæ–¹æ¡ˆæœ‰ä»€éº¼ä¸åŒã€‚'
category: Technical Discussion
tags: ['Web Components']
publishDate: 2024-07-27
---

## å‰è¨€

å¾å¾ˆæ—©ä»¥å‰å°±å¤§è‡´çŸ¥é“ç€è¦½å™¨é–‹å§‹æ¨å‡º Web Components ç›¸é—œ API èˆ‡æ¨™æº–ï¼Œä½†ä¸€ç›´æ²’æœ‰æ©Ÿæœƒåœ¨å¯¦æˆ°ä¸­ä½¿ç”¨é€™é …æŠ€è¡“ã€‚

æœƒæƒ³æ’°å¯«é€™ç¯‡æ–‡ç« è¨˜éŒ„æ˜¯å› ç‚ºéš¨è‘—æ™‚é–“æ¨ç§»ç™¼ç¾ Web Components çš„æ‡‰ç”¨ç¯„ç–‡è¶Šä¾†è¶Šå»£ï¼Œä¸¦ä¸”ä¹Ÿå¯ä»¥çœ‹åˆ°å„å¤§æ¡†æ¶å¥—ä»¶ç›¸ç¹¼æ”¯æ´åŸç”Ÿ Web Componentsï¼Œåƒæ˜¯ï¼š[Swiper](https://swiperjs.com/)ä¹Ÿå»ºè­°è½‰å‘ Web Components å¯¦ä½œçš„ç‰ˆæœ¬ã€[Vue and Web Components](https://vuejs.org/guide/extras/web-components)ã€[React Custom HTML elements](https://react.dev/reference/react-dom/components#custom-html-elements) ä¹Ÿæœ‰æåˆ°å¦‚ä½•èˆ‡ Web Components é…åˆã€‚

å› æ­¤è¶è‘—æœ‰ç©ºä¹Ÿä¾†äº†è§£ä¸€ä¸‹ç›¸é—œçŸ¥è­˜ï¼Œä¸¦ä¸”åˆ†æå®ƒèˆ‡ç¾æœ‰çš„è§£æ±ºæ–¹æ¡ˆæœ‰ä»€éº¼ä¸åŒã€‚

## ä»€éº¼æ˜¯ Web Components

Web Components æ˜¯ä¸€ç³»åˆ—ç€è¦½å™¨ API æ¨™æº–è®“é–‹ç™¼è€…å¯ä»¥åœ¨å®¢æˆ¶ç«¯ç’°å¢ƒå‰µå»ºè‡ªå®šç¾©ã€å¯å®¢è£½åŒ–ã€ç¨ç«‹çš„ HTML å…ƒä»¶ã€‚å¯ä»¥åœ¨ä»»ä½•ç¾ä»£ç€è¦½å™¨ç’°å¢ƒä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦é¡å¤–çš„æ¡†æ¶æˆ–å·¥å…·ã€‚

ç›¸ä¿¡éå¸¸å¤šå‰ç«¯éƒ½æœ‰æ¥è§¸é Vueã€Reactã€Angular é€™é¡æ¡†æ¶å¥—ä»¶ï¼Œä¹Ÿç†Ÿæ‚‰å®ƒå€‘æä¾›çš„å…ƒä»¶æ¦‚å¿µï¼Œä½†å…·é«”ä¾†èªª Web Components èˆ‡é€™äº›æ¡†æ¶èº«ç‚ºç€è¦½å™¨åŸç”ŸåŠŸèƒ½ä¹‹å¤–æœ‰ä»€éº¼ä¸åŒå‘¢ï¼Ÿ

- **åŸç”Ÿä¾¿åˆ©**ï¼šWeb Components æ˜¯å­˜åœ¨æ–¼ç€è¦½å™¨çš„åŸç”Ÿ APIï¼Œå› æ­¤ç„¡é ˆå»ºç½®ä»»ä½•ç’°å¢ƒå³å¯ä½¿ç”¨ã€‚
- **ä¾·é™æ€§**ï¼šWeb Components è¢«è¨­è¨ˆæ‡‰ç”¨æ–¼å®¢æˆ¶ç«¯ç’°å¢ƒï¼Œç„¡æ³•åƒç¾ä»£æ¡†æ¶å¥—ä»¶ä¸€æ¨£æä¾›ä¼ºæœå™¨ç«¯æ¸²æŸ“(SSR)çš„åŠŸèƒ½ï¼Œåƒ Nextã€Nuxtã€‚
- **ç¤¾ç¾¤æ”¯æ´åº¦**ï¼šè«–ç•¶å‰ç¤¾ç¾¤æ”¯æ´åº¦ï¼Œç¾ä»£å‰ç«¯æ¡†æ¶å¥—ä»¶å€‘çš„æ”¯æ´åº¦é é é«˜æ–¼ Web Componentï¼Œå¤§å¤šæ•¸å·²æ–¼æ—©æœŸå·²ç¶“ç™¼å±•ä¸€å¥—å®Œå–„çš„è§£æ±ºæ–¹æ¡ˆï¼Œç«‹å³æ›¿æ› Web Components ä¸¦ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚ä½†å¯ä»¥ç¢ºå®šçš„æ˜¯**é€™é …æ¨™æº–çš„æ¨å‡ºå°‡æœƒå‡èšå‰ç«¯é—œæ–¼å…ƒä»¶ UI çš„å¯¦ä½œæ–¹å¼**ã€‚

## å»ºç«‹ Web Components

å…ˆè®“æˆ‘å€‘å‰µå»ºä¸€å€‹è‡ªå®šç¾©çš„ `hello-world` å…ƒç´ å†ä¾åºèªªæ˜ï¼š

```js
class HelloWorld extends HTMLElement {
  constructor() {
    super(); // èª¿ç”¨çˆ¶é¡(HTMLElement Class)çš„ constructor
    this.innerHTML = '<h1>Hello World</h1>';
  }
}

window.customElements.define('hello-world', HelloWorld);
```

å¯ä»¥ç™¼ç¾æ•´å€‹å®¢è£½åŒ–å…ƒç´ çš„å»ºç«‹éç¨‹éå¸¸çš„ç°¡å–®ï¼Œé¦–å…ˆæ˜¯å»ºç«‹ä¸€å€‹ç¹¼æ‰¿è‡ª `HTMLElement` çš„ Classï¼Œç„¶å¾Œåœ¨ `constructor` ä¸­è¨­å®šå…ƒç´ çš„å…§å®¹ï¼Œæœ€å¾Œä½¿ç”¨ `window.customElements.define` æ–¹æ³•è¨»å†Šå…ƒç´ ï¼Œä¾¿å¯ä»¥åœ¨ HTML ç•¶ä¸­è‡ªç”±çš„åŠ å…¥æ–°å®šç¾©å¥½çš„å…ƒç´ ã€‚

```html
<hello-world></hello-world>
```

å¯ä»¥ç‚ºå…ƒç´ åŠ å…¥ä»»ä½•ä½ æƒ³è¦çš„å±¬æ€§ã€æ–¹æ³•ã€äº‹ä»¶ä¸¦ä¸”é‡è¤‡ç½®å…¥åœ¨é é¢ä»»ä½•è§’è½ï¼Œå°±åƒä»»ä½• HTML å…ƒç´ ä¸€æ¨£ï¼å”¯ä¸€éœ€è¦ç•™æ„çš„æ˜¯å…ƒç´ å‘½åæœ‰ä¸€å®šçš„åŸå‰‡éœ€è¦éµå®ˆï¼š[Valid custom element names](https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define#valid_custom_element_names)ã€‚

## ç”Ÿå‘½é€±æœŸ

Web Components å…·å‚™å°æ‡‰çš„ç”Ÿå‘½é€±æœŸï¼š

- `constructor()`ï¼šåˆå§‹åŒ–å…ƒç´ å¯¦ä¾‹ã€‚
- `connectedCallback()`ï¼šç•¶å…ƒç´ è¢«æ’å…¥åˆ° DOM ä¸­æ™‚èª¿ç”¨ã€‚
- `disconnectedCallback()`ï¼šç•¶å…ƒç´ å¾ DOM ä¸­ç§»é™¤æ™‚èª¿ç”¨ã€‚
- `attributeChangedCallback()`ï¼šç•¶å…ƒç´ çš„å±¬æ€§è¢«å¢åŠ ã€ç§»é™¤ã€æ›´æ–°æ™‚èª¿ç”¨ã€‚

å¯ä»¥æ ¹æ“šéœ€æ±‚åœ¨å®¢è£½åŒ–å…ƒç´ ä¸­æ ¹æ“šç”Ÿå‘½é€±æœŸé€²è¡Œæ“ä½œï¼Œä¾‹å¦‚ï¼šç•¶å…ƒç´ è¢«æ·»åŠ åˆ° DOM ä¸­æ™‚ç¶å®šäº‹ä»¶ç›£è½ï¼Œä¸¦åœ¨ç§»é™¤æ™‚è§£é™¤ã€‚

## Shadow DOM

å–®ç´”çš„æ“ç¸±é é¢ DOM æ˜¯é•·ä¹…ä»¥ä¾†å‰ç«¯å€‘ç†Ÿæ‚‰çš„æ–¹å¼ï¼Œä½†æ“´å±•æ€§å»ä¸å¤ªå¥½ï¼ŒåŸå› æ˜¯å› ç‚ºæˆ‘å€‘ç„¡æ³•ç¢ºä¿è‡ªå®šç¾©å…ƒç´ çš„æ¨£å¼èˆ‡è¡Œç‚ºä¸æœƒå—å¤–éƒ¨å½±éŸ¿ï¼Œé€™æ™‚å€™ Shadow DOM å°±èƒ½æ´¾ä¸Šç”¨å ´ã€‚

èˆ‰ä¾‹ HTML åŸç”Ÿçš„ `<Select>` å…ƒç´ ï¼Œæœƒç™¼ç¾ä¸åŒç€è¦½å™¨éƒ½ç‚ºå…¶é è¨­è£½ä½œäº†ä¸€äº› DOM ç¨ç«‹æ–¼æ•´é«”ç¶²é ï¼ŒèƒŒå¾Œæ˜¯å› ç‚ºä½¿ç”¨äº† Shadow DOMï¼Œå¯ä»¥æ‰“é–‹é¡¯ç¤º user agent shadow DOM è¨­å®šä¾†è§€å¯Ÿå„ç€è¦½å™¨èƒŒå¾Œæ˜¯å¦‚ä½•å¯¦ä½œå„é …å…ƒç´ ã€‚

![Chrome ç€è¦½å™¨ user agent shadow dom è¨­å®š](show-user-agent-shadow-dom.webp 'é–‹å•Ÿ Chrome ç€è¦½å™¨ user agent shadow dom è¨­å®š')
![Select Shadow DOM](select-shadow-dom.webp 'Select Shadow DOM')

ä½ æœƒå¸Œæœ›è‡ªå®šç¾©å…ƒç´ ä¹Ÿèƒ½åƒ `<Select>` ä¸€æ¨£å…·æœ‰å®Œå…¨ç¨ç«‹çš„æ¨£å¼èˆ‡è¡Œç‚ºï¼Œé€™æ™‚å€™ Shadow DOM å°±èƒ½æ´¾ä¸Šç”¨å ´ã€‚

### ç¬¬ä¸€æ­¥ï¼šå‰µå»º Shadow DOM Root

æ ¹æ“šå…ˆå‰çš„ HelloWorld ç¯„ä¾‹ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ `constructor` ä¸­å‰µå»º Shadow DOM Root é€é `attachShadow` æ–¹æ³•ï¼Œè¨­ç½® [mode](https://developer.mozilla.org/en-US/docs/Web/API/Element/attachShadow#mode) æ±ºå®šæˆ‘å€‘åœ¨å‰µå»ºå¾Œæ˜¯å¦å¯ä»¥é€é `this.shadowRoot` ä¾†ä¿®æ”¹ Shadow DOMã€‚

```js
class HelloWorld extends HTMLElement {
  constructor() {
    super();
    const shadowRoot = this.attachShadow({ mode: 'open' }); // open & closed å…è¨±å‰µå»ºçš„ ShadowDom æ˜¯å¦å…è¨±ä¿®æ”¹
  }
}
```

### ç¬¬äºŒæ­¥ï¼šå‰µå»º Template

å‰µå»º Shadow DOM Root å¾Œå¯ä»¥è£½ä½œå°æ‡‰çš„ template å…ƒç´ èˆ‡æ¨£å¼ï¼š

```js
const template = document.createElement('template');
template.innerHTML = `
<style>
  h3 {color: green}
</style>
<h3 data-title>
</h3>
`;
```

### ç¬¬ä¸‰æ­¥ï¼šå°‡ Template æ’å…¥ Shadow DOM

é€é [cloneNode](https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode) + [deep åƒæ•¸](https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode) å¯ä»¥å°‡æ‰€æœ‰çš„ template å…§å®¹æ’å…¥ Shadow DOM ä¸­ã€‚ä¹Ÿå¯ä»¥é‡å° shadowRoot é€²è¡Œå…ƒç´ çš„æœå°‹èˆ‡ä¿®æ”¹ï¼Œèˆ‰ä¾‹å…ˆå‰è£½ä½œçš„ template å°±é åŸ‹äº†ä¸€å€‹ `data-title` çš„å±¬æ€§ï¼Œé€éæœå°‹è©²é …å±¬æ€§æ‰€åœ¨çš„å…ƒç´ å¯ä»¥è¼•æ˜“çš„æ›´æ”¹å…¶å…§å®¹é€é JSï¼š

```js
shadowRoot.appendChild(template.content.cloneNode(true));
shadowRoot.querySelector('[data-title]').innerText = 'foobar';
```

## Slot

`<slot>` æ˜¯ Web Components å…§å»ºçš„ HTML å…ƒç´ ï¼Œä¸€å€‹ä½”ä½ç¬¦ç”¨æ–¼ä»£è¡¨è¼¸å…¥å®¢è£½åŒ–å…ƒç´ çš„å…§å®¹ï¼Œèˆ‰ä¾‹ä¾†èªªä»¥ä¸‹æ³¨å…¥ `hello-world` å®¢è£½åŒ–å…ƒç´ çš„å…§å®¹æ‡‰è©²å¦‚ä½•è™•ç†ï¼Ÿ

```html
<hello-world>
  <span>Foobar</span>
</hello-world>
```

å¯ä»¥é€é slot ä¾†ç‚ºå…¶å®‰æ’ï¼š

```js
const template = document.createElement('template');
template.innerHTML = `
<style>
  h3 {color: green}
</style>
<h3 data-title>
  <slot></slot>
</h3>
`;
```

### å…·å Slot

å¯ä»¥é€é `name` å±¬æ€§ä¾†å€åˆ†å¤šå€‹ slotï¼š

```js
const template = document.createElement('template');
template.innerHTML = `
<h3><slot name="title" /></h3>
<p><slot name="content" /></p>
`;
```

ä¸¦ä¸”åœ¨ HTML ä¸­é€é `slot` å±¬æ€§ä¾†æŒ‡å®šå°æ‡‰çš„ slot åç¨±ï¼š

```html
<hello-world>
  <span slot="title">Title</span>
  <span slot="content">Content</span>
</hello-world>
```

## å¯¦ä½œè¨ˆæ™‚å™¨

è®“æˆ‘å€‘é€é Web Components å¯¦ä½œä¸€å€‹[ç°¡å–®çš„è¨ˆæ™‚å™¨å…ƒä»¶](https://codepen.io/riecball/pen/OJebZaN)ï¼š

```js
class Counter extends HTMLElement {
  constructor() {
    super();
    this.count = 0;
    this.attachShadow({ mode: 'open' });
  }

  connectedCallback() {
    this.render();
    this.shadowRoot.querySelector('[data-increment]').addEventListener('click', () => this.increment());
    this.shadowRoot.querySelector('[data-decrement]').addEventListener('click', () => this.decrement());
  }

  increment() {
    this.count++;
    this.updateCount();
  }

  decrement() {
    this.count--;
    this.updateCount();
  }

  updateCount() {
    this.shadowRoot.querySelector('[data-count]').textContent = `Count: ${this.count}`;
  }

  render() {
    this.shadowRoot.innerHTML = `
      <style>
        :host {
          display: block;
          text-align: center;
        }
        button {
          font-size: 1rem;
          padding: 0.5em 1em;
          margin-top: 1em;
        }
      </style>
      <div data-count>Count: ${this.count}</div>
      <button data-increment>Increment</button>
      <button data-decrement>Decrement</button>
    `;
  }
}

customElements.define('app-counter', Counter);
```

## ç¸½çµ

ä»¥ä¸Šç°¡å–®çš„å¯¦éš›æ“ä½œå‰µå»º Web Components å¾Œç™¼ç¾ç›¸è¼ƒæ–¼å…¶ä»–æˆç†Ÿçš„ JS æ¡†æ¶å¥—ä»¶ï¼Œå®ƒæ›´åƒæ˜¯ä¸€å€‹åº•å±¤å®¢è£½åŒ– DOM å…ƒç´ çš„ API æ¨™æº–ï¼Œç›¸è¼ƒæ–¼ç•¶å‰è¤‡é›œçš„å‰ç«¯éœ€æ±‚ï¼š

- å®£å‘Šå¼ä¸”ç°¡æ½”é«˜æ•ˆçš„æ¨¡æ¿ç³»çµ±
- éŸ¿æ‡‰å¼çš„ç‹€æ…‹èˆ‡å°æ‡‰çš„è·¨çµ„ä»¶é€šè¨Š
- ä¼ºæœç«¯æ¸²æŸ“

Web Components ä¸€æ¨£éƒ½æ²’æœ‰ ğŸ˜…ï¼Œä¸¦ä¸æœƒå–ä»£ç¾æœ‰çš„è§£æ±ºæ–¹æ¡ˆï¼Œä¸éå¯ä»¥æœŸå¾…æ›´å¤šç¶²é å…ƒä»¶çš„å¯¦ä½œæ–¹å¼æœƒå‘ç€è¦½å™¨åŸç”Ÿ API é æ”ã€‚æ­¤å¤–å®Œå…¨åŸºæ–¼ Web Components çš„è¼•é‡å¥—ä»¶åƒæ˜¯ [Lit](https://lit.dev/) ä¹Ÿå¯ä»¥ç•™æ„çœ‹çœ‹ã€‚

## å»¶ä¼¸é–±è®€

- [The Story of Web Components - uidotdev](https://www.youtube.com/watch?v=fKqgdT-KLrM)
- [Web Components Crash Course - Traversy Meid](https://www.youtube.com/watch?v=PCWaFLy3VUo)
- [Vue and Web Components - Vue.js](https://vuejs.org/guide/extras/web-components)
- [What Are Web Components? - Syntax](https://www.youtube.com/watch?v=83W63gTVlSk)
- [Web components - JavaScript.INFO](https://javascript.info/web-components)
