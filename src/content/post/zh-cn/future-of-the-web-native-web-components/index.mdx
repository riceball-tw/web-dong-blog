---
isDraft: false
icon:
  name: material-symbols:developer-guide-outline-rounded
  title: ç®±å­ç¬¦å·
subHeadline: Future of the Web - Native Web Components
headline: äº†è§£ç½‘é¡µç»„ä»¶åŒ–çš„æœªæ¥ï¼šWeb Components
excerpt: ä»å¾ˆæ—©ä»¥å‰å°±å¤§è‡´çŸ¥é“æµè§ˆå™¨å¼€å§‹æ¨å‡º Web Components ç›¸å…³ API ä¸æ ‡å‡†ï¼Œä½†ä¸€ç›´æ²¡æœ‰æœºä¼šåœ¨å®æˆ˜ä¸­ä½¿ç”¨è¿™é¡¹æŠ€æœ¯ã€‚æƒ³æ’°å†™è¿™ç¯‡æ–‡ç« è®°å½•æ˜¯å› ä¸ºéšç€æ—¶é—´æ¨ç§»å‘ç° Web Components çš„åº”ç”¨èŒƒå›´è¶Šæ¥è¶Šå¹¿ï¼Œå› æ­¤è¶ç€æœ‰ç©ºä¹Ÿæ¥äº†è§£ä¸€ä¸‹ç›¸å…³çŸ¥è¯†ï¼Œå¹¶ä¸”åˆ†æå®ƒä¸ç°æœ‰çš„è§£å†³æ–¹æ¡ˆæœ‰ä»€ä¹ˆä¸åŒã€‚
category: Technical Discussion
tags:
  - Web API
publishDate: 2024-07-27
---

## å‰è¨€

ä»å¾ˆæ—©ä»¥å‰å°±å¤§è‡´çŸ¥é“æµè§ˆå™¨å¼€å§‹æ¨å‡º Web Components ç›¸å…³ API ä¸æ ‡å‡†ï¼Œä½†ä¸€ç›´æ²¡æœ‰æœºä¼šåœ¨å®æˆ˜ä¸­ä½¿ç”¨è¿™é¡¹æŠ€æœ¯ã€‚

ä¼šæƒ³æ’°å†™è¿™ç¯‡æ–‡ç« è®°å½•æ˜¯å› ä¸ºéšç€æ—¶é—´æ¨ç§»å‘ç° Web Components çš„åº”ç”¨èŒƒå›´è¶Šæ¥è¶Šå¹¿ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥çœ‹åˆ°å„å¤§æ¡†æ¶å¥—ä»¶ç›¸ç»§æ”¯æŒåŸç”Ÿ Web Componentsï¼Œåƒæ˜¯ï¼š[Swiper](https://swiperjs.com/)ä¹Ÿå»ºè®®è½¬å‘ Web Components å®ä½œçš„ç‰ˆæœ¬ã€[Vue and Web Components](https://vuejs.org/guide/extras/web-components)ã€[React Custom HTML elements](https://react.dev/reference/react-dom/components#custom-html-elements) ä¹Ÿæœ‰æåˆ°å¦‚ä½•ä¸ Web Components é…åˆã€‚

å› æ­¤è¶ç€æœ‰ç©ºä¹Ÿæ¥äº†è§£ä¸€ä¸‹ç›¸å…³çŸ¥è¯†ï¼Œå¹¶ä¸”åˆ†æå®ƒä¸ç°æœ‰çš„è§£å†³æ–¹æ¡ˆæœ‰ä»€ä¹ˆä¸åŒã€‚

## ä»€ä¹ˆæ˜¯ Web Components

Web Components æ˜¯ä¸€ç³»åˆ—æµè§ˆå™¨ API æ ‡å‡†è®©å¼€å‘è€…å¯ä»¥åœ¨å®¢æˆ·ç«¯ç¯å¢ƒåˆ›å»ºè‡ªå®šä¹‰ã€å¯å®šåˆ¶ã€ç‹¬ç«‹çš„ HTML å…ƒä»¶ã€‚å¯ä»¥åœ¨ä»»ä½•ç°ä»£æµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦é¢å¤–çš„æ¡†æ¶æˆ–å·¥å…·ã€‚

ç›¸ä¿¡éå¸¸å¤šå‰ç«¯éƒ½æœ‰æ¥è§¦è¿‡ Vueã€Reactã€Angular è¿™ç±»æ¡†æ¶å¥—ä»¶ï¼Œä¹Ÿç†Ÿæ‚‰å®ƒä»¬æä¾›çš„å…ƒä»¶æ¦‚å¿µï¼Œä½†å…·ä½“æ¥è¯´ Web Components ä¸è¿™äº›æ¡†æ¶èº«ä¸ºæµè§ˆå™¨åŸç”ŸåŠŸèƒ½ä¹‹å¤–æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ

- **åŸç”Ÿä¾¿åˆ©**ï¼šWeb Components æ˜¯å­˜åœ¨äºæµè§ˆå™¨çš„åŸç”Ÿ APIï¼Œå› æ­¤æ— é¡»å»ºç½®ä»»ä½•ç¯å¢ƒå³å¯ä½¿ç”¨ã€‚
- **å±€é™æ€§**ï¼šWeb Components è¢«è®¾è®¡åº”ç”¨äºå®¢æˆ·ç«¯ç¯å¢ƒï¼Œæ— æ³•åƒç°ä»£æ¡†æ¶å¥—ä»¶ä¸€æ ·æä¾›æœåŠ¡å™¨ç«¯æ¸²æŸ“(SSR)çš„åŠŸèƒ½ï¼Œåƒ Nextã€Nuxtã€‚
- **ç¤¾åŒºæ”¯æŒåº¦**ï¼šè®ºå½“å‰ç¤¾åŒºæ”¯æŒåº¦ï¼Œç°ä»£å‰ç«¯æ¡†æ¶å¥—ä»¶ä»¬çš„æ”¯æŒåº¦è¿œè¿œé«˜äº Web Componentï¼Œå¤§å¤šæ•°å·²äºæ—©æœŸå·²ç»å‘å±•ä¸€å¥—å®Œå–„çš„è§£å†³æ–¹æ¡ˆï¼Œç«‹å³æ›¿æ¢ Web Components å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚ä½†å¯ä»¥ç¡®å®šçš„æ˜¯**è¿™é¡¹æ ‡å‡†çš„æ¨å‡ºå°†ä¼šå‡èšå‰ç«¯å…³äºç»„ä»¶ UI çš„å®ç°æ–¹å¼**ã€‚

## å»ºç«‹ Web Components

å…ˆè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ `hello-world` å…ƒç´ å†ä¾åºè¯´æ˜ï¼š

```js
class HelloWorld extends HTMLElement {
  constructor() {
    super(); // è°ƒç”¨çˆ¶ç±»(HTMLElement Class)çš„ constructor
    this.innerHTML = '<h1>Hello World</h1>';
  }
}

window.customElements.define('hello-world', HelloWorld);
```

å¯ä»¥å‘ç°æ•´ä¸ªå®šåˆ¶åŒ–å…ƒç´ çš„å»ºç«‹è¿‡ç¨‹éå¸¸çš„ç®€å•ï¼Œé¦–å…ˆæ˜¯å»ºç«‹ä¸€ä¸ªç»§æ‰¿è‡ª `HTMLElement` çš„ Classï¼Œç„¶ååœ¨ `constructor` ä¸­è®¾ç½®å…ƒç´ çš„å†…å®¹ï¼Œæœ€åä½¿ç”¨ `window.customElements.define` æ–¹æ³•æ³¨å†Œå…ƒç´ ï¼Œä¾¿å¯ä»¥åœ¨ HTML å½“ä¸­è‡ªç”±çš„åŠ å…¥æ–°å®šä¹‰å¥½çš„å…ƒç´ ã€‚

```html
<hello-world></hello-world>
```

å¯ä»¥ä¸ºå…ƒç´ åŠ å…¥ä»»ä½•ä½ æƒ³è¦çš„å±æ€§ã€æ–¹æ³•ã€äº‹ä»¶å¹¶ä¸”é‡å¤ç½®å…¥åœ¨é¡µé¢ä»»ä½•è§’è½ï¼Œå°±åƒä»»ä½• HTML å…ƒç´ ä¸€æ ·ï¼å”¯ä¸€éœ€è¦ç•™æ„çš„æ˜¯å…ƒç´ å‘½åæœ‰ä¸€å®šçš„åŸåˆ™éœ€è¦éµå®ˆï¼š[Valid custom element names](https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define#valid_custom_element_names)ã€‚

## ç”Ÿå‘½å‘¨æœŸ

Web Components å…·å¤‡å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸï¼š

- `constructor()`ï¼šåˆå§‹åŒ–å…ƒç´ å®ä¾‹ã€‚
- `connectedCallback()`ï¼šå½“å…ƒç´ è¢«æ’å…¥åˆ° DOM ä¸­æ—¶è°ƒç”¨ã€‚
- `disconnectedCallback()`ï¼šå½“å…ƒç´ ä» DOM ä¸­ç§»é™¤æ—¶è°ƒç”¨ã€‚
- `attributeChangedCallback()`ï¼šå½“å…ƒç´ çš„å±æ€§è¢«å¢åŠ ã€ç§»é™¤ã€æ›´æ–°æ—¶è°ƒç”¨ã€‚

````markdown
å¯ä»¥æ ¹æ®éœ€æ±‚åœ¨å®¢åˆ¶åŒ–å…ƒç´ ä¸­æ ¹æ®ç”Ÿå‘½å‘¨æœŸè¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚ï¼šå½“å…ƒç´ è¢«æ·»åŠ åˆ° DOM ä¸­æ—¶ç»‘å®šäº‹ä»¶ç›‘å¬ï¼Œå¹¶åœ¨ç§»é™¤æ—¶è§£é™¤ã€‚

## Shadow DOM

å•çº¯çš„æ“çºµé¡µé¢ DOM æ˜¯é•¿ä¹…ä»¥æ¥å‰ç«¯ä»¬ç†Ÿæ‚‰çš„æ–¹å¼ï¼Œä½†æ‰©å±•æ€§å´ä¸å¤ªå¥½ï¼ŒåŸå› æ˜¯å› ä¸ºæˆ‘ä»¬æ— æ³•ç¡®ä¿è‡ªå®šä¹‰å…ƒç´ çš„æ ·å¼ä¸è¡Œä¸ºä¸ä¼šå—å¤–éƒ¨å½±å“ï¼Œè¿™æ—¶å€™ Shadow DOM å°±èƒ½æ´¾ä¸Šç”¨åœºã€‚

ä¸¾ä¾‹ HTML åŸç”Ÿçš„ `<Select>` å…ƒç´ ï¼Œä¼šå‘ç°ä¸åŒæµè§ˆå™¨éƒ½ä¸ºå…¶é¢„è®¾åˆ¶ä½œäº†ä¸€äº› DOM ç‹¬ç«‹äºæ•´ä½“ç½‘é¡µï¼ŒèƒŒåæ˜¯å› ä¸ºä½¿ç”¨äº† Shadow DOMï¼Œå¯ä»¥æ‰“å¼€æ˜¾ç¤º user agent shadow DOM è®¾ç½®æ¥è§‚å¯Ÿå„æµè§ˆå™¨èƒŒåæ˜¯å¦‚ä½•å®ç°å„é¡¹å…ƒç´ ã€‚

![Chrome æµè§ˆå™¨ user agent shadow dom è®¾ç½®](show-user-agent-shadow-dom.webp 'å¼€å¯ Chrome æµè§ˆå™¨ user agent shadow dom è®¾ç½®')
![Select Shadow DOM](select-shadow-dom.webp 'Select Shadow DOM')

ä½ ä¼šå¸Œæœ›è‡ªå®šä¹‰å…ƒç´ ä¹Ÿèƒ½åƒ `<Select>` ä¸€æ ·å…·æœ‰å®Œå…¨ç‹¬ç«‹çš„æ ·å¼ä¸è¡Œä¸ºï¼Œè¿™æ—¶å€™ Shadow DOM å°±èƒ½æ´¾ä¸Šç”¨åœºã€‚

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Shadow DOM Root

æ ¹æ®å…ˆå‰çš„ HelloWorld ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `constructor` ä¸­åˆ›å»º Shadow DOM Root é€šè¿‡ `attachShadow` æ–¹æ³•ï¼Œè®¾ç½® [mode](https://developer.mozilla.org/en-US/docs/Web/API/Element/attachShadow#mode) å†³å®šæˆ‘ä»¬åœ¨åˆ›å»ºåæ˜¯å¦å¯ä»¥é€šè¿‡ `this.shadowRoot` æ¥ä¿®æ”¹ Shadow DOMã€‚

```js
class HelloWorld extends HTMLElement {
  constructor() {
    super();
    const shadowRoot = this.attachShadow({ mode: 'open' }); // open & closed å…è®¸åˆ›å»ºçš„ ShadowDom æ˜¯å¦å…è®¸ä¿®æ”¹
  }
}
```
````

### ç¬¬äºŒæ­¥ï¼šåˆ›å»º Template

åˆ›å»º Shadow DOM Root åå¯ä»¥åˆ¶ä½œå¯¹åº”çš„ template å…ƒç´ ä¸æ ·å¼ï¼š

```js
const template = document.createElement('template');
template.innerHTML = `
<style>
  h3 {color: green}
</style>
<h3 data-title>
</h3>
`;
```

### ç¬¬ä¸‰æ­¥ï¼šå°† Template æ’å…¥ Shadow DOM

é€šè¿‡ [cloneNode](https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode) + [deep å‚æ•°](https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode) å¯ä»¥å°†æ‰€æœ‰çš„ template å†…å®¹æ’å…¥ Shadow DOM ä¸­ã€‚ä¹Ÿå¯ä»¥é’ˆå¯¹ shadowRoot è¿›è¡Œå…ƒç´ çš„æœç´¢ä¸ä¿®æ”¹ï¼Œä¸¾ä¾‹å…ˆå‰åˆ¶ä½œçš„ template å°±é¢„åŸ‹äº†ä¸€ä¸ª `data-title` çš„å±æ€§ï¼Œé€šè¿‡æœç´¢è¯¥é¡¹å±æ€§æ‰€åœ¨çš„å…ƒç´ å¯ä»¥è½»æ˜“çš„æ›´æ”¹å…¶å†…å®¹é€šè¿‡ JSï¼š

```js
shadowRoot.appendChild(template.content.cloneNode(true));
shadowRoot.querySelector('[data-title]').innerText = 'foobar';
```

## Slot

`<slot>` æ˜¯ Web Components å†…å»ºçš„ HTML å…ƒç´ ï¼Œä¸€ä¸ªå ä½ç¬¦ç”¨äºä»£è¡¨è¾“å…¥å®¢åˆ¶åŒ–å…ƒç´ çš„å†…å®¹ï¼Œä¸¾ä¾‹æ¥è¯´ä»¥ä¸‹æ³¨å…¥ `hello-world` å®¢åˆ¶åŒ–å…ƒç´ çš„å†…å®¹åº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

```html
<hello-world>
  <span>Foobar</span>
</hello-world>
```

å¯ä»¥é€šè¿‡ slot æ¥ä¸ºå…¶å®‰æ’ï¼š

```js
const template = document.createElement('template');
template.innerHTML = `
<style>
  h3 {color: green}
</style>
<h3 data-title>
  <slot></slot>
</h3>
`;
```

### å…·å Slot

å¯ä»¥é€šè¿‡ `name` å±æ€§æ¥åŒºåˆ†å¤šä¸ª slotï¼š

```js
const template = document.createElement('template');
template.innerHTML = `
<h3><slot name="title" /></h3>
<p><slot name="content" /></p>
`;
```

å¹¶ä¸”åœ¨ HTML ä¸­é€šè¿‡ `slot` å±æ€§æ¥æŒ‡å®šå¯¹åº”çš„ slot åç§°ï¼š

```html
<hello-world>
  <span slot="title">Title</span>
  <span slot="content">Content</span>
</hello-world>
```

## å®ä½œè®¡æ•°å™¨

è®©æˆ‘ä»¬é€šè¿‡ Web Components å®ä½œä¸€ä¸ª[ç®€å•çš„è®¡æ•°å™¨ç»„ä»¶](https://codepen.io/riecball/pen/OJebZaN)ï¼š

```js
class Counter extends HTMLElement {
  constructor() {
    super();
    this.count = 0;
    this.attachShadow({ mode: 'open' });
  }

  connectedCallback() {
    this.render();
    this.shadowRoot.querySelector('[data-increment]').addEventListener('click', () => this.increment());
    this.shadowRoot.querySelector('[data-decrement]').addEventListener('click', () => this.decrement());
  }

  increment() {
    this.count++;
    this.updateCount();
  }

  decrement() {
    this.count--;
    this.updateCount();
  }

  updateCount() {
    this.shadowRoot.querySelector('[data-count]').textContent = `Count: ${this.count}`;
  }

  render() {
    this.shadowRoot.innerHTML = `
      <style>
        :host {
          display: block;
          text-align: center;
        }
        button {
          font-size: 1rem;
          padding: 0.5em 1em;
          margin-top: 1em;
        }
      </style>
      <div data-count>Count: ${this.count}</div>
      <button data-increment>Increment</button>
      <button data-decrement>Decrement</button>
    `;
  }
}

customElements.define('app-counter', Counter);
```

## æ€»ç»“

ä»¥ä¸Šç®€å•çš„å®é™…æ“ä½œåˆ›å»º Web Components åå‘ç°ç›¸è¾ƒäºå…¶ä»–æˆç†Ÿçš„ JS æ¡†æ¶å¥—ä»¶ï¼Œå®ƒæ›´åƒæ˜¯ä¸€å€‹åº•å±‚å®¢åˆ¶åŒ– DOM å…ƒç´ çš„ API æ ‡å‡†ï¼Œç›¸è¾ƒäºå½“å‰å¤æ‚çš„å‰ç«¯éœ€æ±‚ï¼š

- å®£å‘Šå¼ä¸”ç®€æ´é«˜æ•ˆçš„æ¨¡æ¿ç³»ç»Ÿ
- å“åº”å¼çš„çŠ¶æ€ä¸å¯¹åº”çš„è·¨ç»„ä»¶é€šè®¯
- ä¼ºæœç«¯æ¸²æŸ“

Web Components ä¸€æ ·éƒ½æ²¡æœ‰ ğŸ˜…ï¼Œå¹¶ä¸ä¼šå–ä»£ç°æœ‰çš„è§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡å¯ä»¥æœŸå¾…æ›´å¤šç½‘é¡µç»„ä»¶çš„å®ç°æ–¹å¼ä¼šå‘æµè§ˆå™¨åŸç”Ÿ API é æ‹¢ã€‚æ­¤å¤–å®Œå…¨åŸºäº Web Components çš„è½»é‡å¥—ä»¶åƒæ˜¯ [Lit](https://lit.dev/) ä¹Ÿå¯ä»¥ç•™æ„çœ‹çœ‹ã€‚

## å»¶ä¼¸é˜…è¯»

- [The Story of Web Components - uidotdev](https://www.youtube.com/watch?v=fKqgdT-KLrM)
- [Web Components Crash Course - Traversy Meid](https://www.youtube.com/watch?v=PCWaFLy3VUo)
- [Vue and Web Components - Vue.js](https://vuejs.org/guide/extras/web-components)
- [What Are Web Components? - Syntax](https://www.youtube.com/watch?v=83W63gTVlSk)
- [Web components - JavaScript.INFO](https://javascript.info/web-components)
